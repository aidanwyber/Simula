<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: changeset.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: changeset.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Utility for undo/redo functionality and persistence of GUI state.
 */

/**
 * Stores a sequence of generator/gui states enabling undo and redo.
 */
class ChangeSet {
	static localStorageKey = 'changeset';

	changeset = [];
	index = -1; // no state yet

	/**
	 * @param {boolean} [doInitFromLocalStorage=false] whether to load the
	 * last stored state from localStorage.
	 */
	constructor(doInitFromLocalStorage = false) {
		this.doInitFromLocalStorage = doInitFromLocalStorage;
		if (this.doInitFromLocalStorage) {
			this.restoreFromLocalStorage();
		} else {
			this.save();
		}
	}

	/**
	 * Capture current generator and GUI state.
	 * @returns {gui:Object}}
	 */
	getStates() {
		return {
			generator: generator.getState(),
			gui: gui.getState(),
		};
	}

	/** Remove redo history after current index. */
	cutToIndex() {
		this.changeset = this.changeset.slice(0, this.index + 1);
	}

	/**
	 * Push a new JSON state into the history.
	 * @param {string} json
	 */
	addState(json) {
		if (this.changeset[this.index] == json) return;

		this.cutToIndex();
		this.changeset.push(json);
		this.index++;
	}

	/**
	 * Snapshot the current state and optionally persist it to
	 * localStorage.
	 */
	save() {
		const json = JSON.stringify(this.getStates());
		this.addState(json);

		if (this.doInitFromLocalStorage) this.saveToLocalStorage(json);
	}

	/** Step backward in history. */
	undo() {
		if (this.index &lt;= 0) return;
		this.index--;
		this.restore(this.changeset[this.index]);
	}

	/** Step forward in history. */
	redo() {
		if (this.index >= this.changeset.length - 1) return;
		this.index++;
		this.restore(this.changeset[this.index]);
	}

	/**
	 * Restore a JSON encoded state.
	 * @param {string} json
	 */
	restore(json) {
		const state = JSON.parse(json);
		if (state.generator) generator.restoreState(state.generator);
		if (state.gui) gui.restoreState(state.gui);
	}

	/** Store the JSON state in localStorage. */
	saveToLocalStorage(json) {
		localStorage[ChangeSet.localStorageKey] = json;
	}

	/** Retrieve the last stored state from localStorage. */
	restoreFromLocalStorage() {
		const json = localStorage[ChangeSet.localStorageKey];
		if (!json || json.length &lt;= 2) {
			return;
		}
		this.restore(json);
	}

	/**
	 * Save the current state to disk.
	 * @param {string} fileName base name without extension
	 * @param {boolean} [doMinify=true] whether to minify the JSON
	 * @see Generator.getOutputFileName
	 */
	download(fileName, doMinify = true) {
		const json = this.changeset[this.index];
		saveJSON(
			JSON.parse(json),
			fileName + '_' + Generator.getOutputFileName('settings'),
			doMinify
		);
	}

	/**
	 * Load a state from a JSON string.
	 * @param {string} json
	 */
	loadFromJSON(json) {
		this.addState(json);
		this.restore(this.changeset[this.index]);
	}
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Button.html">Button</a></li><li><a href="ChangeSet.html">ChangeSet</a></li><li><a href="ColourBoxes.html">ColourBoxes</a></li><li><a href="ColourTextArea.html">ColourTextArea</a></li><li><a href="Controller.html">Controller</a></li><li><a href="Dialog.html">Dialog</a></li><li><a href="DieIcon.html">DieIcon</a></li><li><a href="Divider.html">Divider</a></li><li><a href="DualRangeInput.html">DualRangeInput</a></li><li><a href="Field.html">Field</a></li><li><a href="FileLoader.html">FileLoader</a></li><li><a href="GUIForP5.html">GUIForP5</a></li><li><a href="GUIImage.html">GUIImage</a></li><li><a href="Generator.html">Generator</a></li><li><a href="ImageLoader.html">ImageLoader</a></li><li><a href="JSONFileLoader.html">JSONFileLoader</a></li><li><a href="Label.html">Label</a></li><li><a href="Lang.html">Lang</a></li><li><a href="MultiColourBoxes.html">MultiColourBoxes</a></li><li><a href="Randomizer.html">Randomizer</a></li><li><a href="RangeSlider.html">RangeSlider</a></li><li><a href="RendererSVG.html">RendererSVG</a></li><li><a href="ResolutionSelect.html">ResolutionSelect</a></li><li><a href="ResolutionTextboxes.html">ResolutionTextboxes</a></li><li><a href="Select.html">Select</a></li><li><a href="Slider.html">Slider</a></li><li><a href="TextFileLoader.html">TextFileLoader</a></li><li><a href="Textarea.html">Textarea</a></li><li><a href="Textbox.html">Textbox</a></li><li><a href="Textfield.html">Textfield</a></li><li><a href="Title.html">Title</a></li><li><a href="Toggle.html">Toggle</a></li><li><a href="ValuedController.html">ValuedController</a></li><li><a href="XYSlider.html">XYSlider</a></li></ul><h3>Global</h3><ul><li><a href="global.html#availableLangKeys">availableLangKeys</a></li><li><a href="global.html#createGUI">createGUI</a></li><li><a href="global.html#dialog">dialog</a></li><li><a href="global.html#dictionary">dictionary</a></li><li><a href="global.html#getAPaperResolutionOptionAtDpi">getAPaperResolutionOptionAtDpi</a></li><li><a href="global.html#lang">lang</a></li><li><a href="global.html#language">language</a></li><li><a href="global.html#parent">parent</a></li><li><a href="global.html#resolutionOptions">resolutionOptions</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Thu Jul 17 2025 10:49:07 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
