<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/gui.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/gui.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Implementation of the GUI framework used by p5Catalyst.
 */

/** Main GUI wrapper that manages fields and controllers. */
class GUIForP5 {
	static verbose = !false;

	fields = [];
	controllers = [];

	isTypingText = false;

	constructor() {
		this.div = createDiv();
		this.div.id('gui');

		this.randomizer = new Randomizer();

		this.loadLightDarkMode();

		this.setLeft();
	}

	setup() {
		for (let controller of this.controllers) {
			controller.setup();
		}
	}

	setLeft() {
		document.querySelector('main').prepend(this.div.elt);
		this.isOnLeftSide = true;
	}

	setRight() {
		document.querySelector('main').append(this.div.elt);
		this.isOnLeftSide = false;
	}

	toggleSide() {
		this.isOnLeftSide ? this.setRight() : this.setLeft();
	}

	loadLightDarkMode() {
		const setting = window.localStorage['isDarkMode'];
		switch (setting) {
			case 'true':
				this.setDarkMode();
				break;
			case 'false':
				this.setLightMode();
				break;
			default:
				this.setAutoLightDarkMode();
		}
	}

	setLightMode() {
		document.body.className = '';
		window.localStorage['isDarkMode'] = 'false';
		this.darkMode = 'false';
		if (this.darkModeButton) this.darkModeButton.setLightMode();
	}

	setDarkMode() {
		document.body.className = 'dark-mode';
		window.localStorage['isDarkMode'] = 'true';
		this.darkMode = 'true';
		if (this.darkModeButton) this.darkModeButton.setDarkMode();
	}

	setAutoLightDarkMode() {
		const isSystemDarkMode = () =>
			window.matchMedia &amp;&amp;
			window.matchMedia('(prefers-color-scheme: dark)').matches;
		if (isSystemDarkMode()) {
			this.setDarkMode();
		} else {
			this.setLightMode();
		}
		window.localStorage['isDarkMode'] = 'auto';
		this.darkMode = 'auto';
		if (this.darkModeButton) this.darkModeButton.setAutoLightDarkMode();
	}

	toggleLightDarkMode() {
		// cycle modes
		switch (this.darkMode) {
			case 'false':
				this.setDarkMode();
				break;
			case 'true':
				this.setAutoLightDarkMode();
				break;
			default:
				this.setLightMode();
		}
	}

	createDarkModeButton() {
		this.darkModeButton = this.addController(
			new Button(this, 'buttonDarkMode', '', controller => {
				this.toggleLightDarkMode();
			})
		);
		this.darkModeButton.controllerElement.id('dark-mode-button');
		this.darkModeButton.setLightMode = () => {
			this.darkModeButton.controllerElement.style(
				'background-image',
				'url("assets/dark-mode/light-mode-icon.svg")'
			);
			this.darkModeButton.controllerElement.elt.title = 'Light mode';
		};
		this.darkModeButton.setDarkMode = () => {
			this.darkModeButton.controllerElement.style(
				'background-image',
				'url("assets/dark-mode/dark-mode-icon.svg")'
			);
			this.darkModeButton.controllerElement.elt.title = 'Dark mode';
		};
		this.darkModeButton.setAutoLightDarkMode = () => {
			this.darkModeButton.controllerElement.style(
				'background-image',
				'url("assets/dark-mode/auto-mode-icon.svg")'
			);
			this.darkModeButton.controllerElement.elt.title =
				'Auto light/dark mode';
		};
		switch (this.darkMode) {
			case 'false':
				this.darkModeButton.setLightMode();
				break;
			case 'true':
				this.darkModeButton.setDarkMode();
				break;
			default:
				this.darkModeButton.setAutoLightDarkMode();
		}
	}

	addField(field) {
		this.fields.push(field);
		return field;
	}

	addHTMLToNewField(html, className = '') {
		let field = this.addField(new Field(this.div, '', className));
		field.div.html(html);
		return field;
	}

	addP5CatalystLogo() {
		let logo = this.addHTMLToNewField(
			`&lt;a href="https://github.com/multitude-amsterdam/p5Catalyst" target="_blank">` +
				`&lt;div class="p5catalyst-logo">&lt;/div>` +
				`&lt;/a>`,
			'footer-logo'
		);
		return logo;
	}

	addDivider() {
		let divider = new Divider(this.div);
		this.addField(divider);
		return divider;
	}

	addController(controller, doAddToRandomizerAs = undefined) {
		this.addField(controller);
		this.controllers.push(controller);
		if (doAddToRandomizerAs !== undefined)
			this.randomizer.addController(controller, doAddToRandomizerAs);
		return controller;
	}

	addLabel(labelText) {
		let label = new Label(this.div, labelText);
		this.addField(label);
		return label;
	}

	addTitle(hSize, titleText, doAlignCenter = false) {
		let title = new Title(
			this.div,
			hSize,
			titleText,
			(doAlignCenter = doAlignCenter)
		);
		this.addField(title);
		return title;
	}

	addImage(url, altText, doAlignCenter = true) {
		let img = new GUIImage(
			this.div,
			url,
			altText,
			(doAlignCenter = doAlignCenter)
		);
		this.addField(img);
		return img;
	}

	hasName(name) {
		return this.controllers.some(controller => controller.name == name);
	}

	getController(name) {
		if (!this.hasName(name)) {
			return undefined;
		}
		return this.controllers[
			this.controllers.map(controller => controller.name).indexOf(name)
		];
	}

	getControllers(names) {
		return this.controllers.filter(controller =>
			names.some(name => {
				if (!this.hasName(name)) {
					return false;
				}
				return controller.name == name;
			})
		);
	}

	getState() {
		return this.controllers
			.filter(controller => controller.value !== undefined)
			.map(controller => ({
				name: controller.name,
				value: controller.getValueForJSON(),
			}));
	}

	restoreState(state) {
		Controller._doUpdateChangeSet = false;
		for (let { name, value } of state) {
			const controller = gui.getController(name);
			if (controller.setValue &amp;&amp; value !== undefined) {
				value = restoreSerializedP5Color(value);
				value = restoreSerializedVec2D(value);
				controller.setValue(value);
			}
		}
		Controller._doUpdateChangeSet = true;
	}
}

/** Helper that randomises controllers marked as such. */
class Randomizer {
	controllers = [];

	constructor() {}

	addController(controller, doRandomize) {
		this.controllers.push(controller);
		let die = new DieIcon(this, controller, doRandomize);
		controller.addDie(die);
		controller.doRandomize = doRandomize;
	}

	removeController(controller) {
		let index = this.controllers.indexOf(controller);
		if (index &lt; 0) {
			console.error('Controller not in list.', controller);
			return;
		}
		this.controllers.splice(index, 1);
	}

	randomize() {
		const controllersToRandomize = this.controllers.filter(
			controller =>
				controller.doRandomize === true &amp;&amp; !controller.isHidden()
		);
		for (let controller of controllersToRandomize) {
			if (controller instanceof ValuedController) {
				controller.randomize();
			}
			if (controller instanceof Button) {
				controller.click();
			}
		}
	}

	toggleDoRandomize(die) {
		let index = this.controllers.map(c => c.die).indexOf(die);
		if (index &lt; 0) {
			console.error('Die not in list.', controller);
			return;
		}
		this.controllers[index].doRandomize =
			this.controllers[index].doRandomize !== true;
		die.setActive(this.controllers[index].doRandomize);
	}
}

/** Small dice icon indicating randomisation state. */
class DieIcon {
	static iconURLs = [
		'assets/dice/die (1).svg',
		'assets/dice/die (2).svg',
		'assets/dice/die (3).svg',
		'assets/dice/die (4).svg',
		'assets/dice/die (5).svg',
		'assets/dice/die (6).svg',
	];

	constructor(randomizer, controller, isActive) {
		this.randomizer = randomizer;

		this.img = createImg('', 'Randomizer die');
		this.img.class('die-icon');
		this.img.mouseClicked(() => this.click());
		this.rot = 0;
		this.randomizeIcon();

		this.setActive(isActive);
	}

	randomizeIcon() {
		// random icon url
		let curURL = this.iconURL;
		do this.iconURL = random(DieIcon.iconURLs);
		while (curURL == this.iconURL);
		this.img.elt.src = this.iconURL;

		// rotate die randomly
		let curRot = this.rot;
		do this.rot = int(random(4));
		while (this.rot == curRot);
		let angle = (this.rot * TAU) / 3;
		this.img.style('rotate', angle + 'rad');
	}

	click() {
		this.randomizer.toggleDoRandomize(this);
	}

	setActive(isActive) {
		this.isActive = isActive;
		this.setDisplay();
	}

	setDisplay() {
		if (this.isActive) {
			this.img.removeClass('disabled');
			this.randomizeIcon();
		} else {
			this.img.addClass('disabled');
		}
	}

	remove() {
		this.img.remove();
	}
}

/** Base GUI element container used by controllers. */
class Field {
	constructor(parentDiv, id, className) {
		this.div = createDiv();
		this.div.parent(parentDiv);
		if (id !== undefined &amp;&amp; id !== null &amp;&amp; id != '') this.div.id(id);
		this.div.class(className);
	}

	setTooltip(tooltip) {
		this.div.elt.title = tooltip;
	}

	hide() {
		this.div.hide();
	}

	show() {
		this.div.elt.style.display = ''; // more general than p5 .show()
		if (this.setDisplay) this.setDisplay(); // XYSlider needs this for now
	}

	isHidden() {
		return this.div.elt.style.display == 'none';
	}
}

/** Text label associated with a controller. */
class Label extends Field {
	constructor(controller, text) {
		super(controller.div, null, 'gui-label');
		this.controller = controller;
		text = lang.process(text, true);
		this.setText(text);
	}

	setText(text) {
		this.text = text;
		this.div.elt.innerText = text;
	}
}

/** Heading element used as a section title. */
class Title extends Field {
	constructor(parentDiv, hSize, text, doAlignCenter = false) {
		super(parentDiv, null, 'gui-title');
		text = lang.process(text, true);
		this.div.html(`&lt;h${hSize}>${text}&lt;/h${hSize}>`);
		if (doAlignCenter) {
			this.div.style('text-align', 'center');
		}
	}
}

/** Block of explanatory text. */
class Textfield extends Field {
	constructor(parentDiv, text, className = undefined, doAlignCenter = false) {
		super(parentDiv, null, 'gui-textfield');
		text = lang.process(text, true);
		this.div.html(`&lt;span>${text}&lt;/span>`);
		if (className) {
			this.div.addClass(className);
		}
		if (doAlignCenter) {
			this.div.style('text-align', 'center');
		}
	}
}

/** Wrapper for &lt;img> elements placed in the GUI. */
class GUIImage extends Field {
	constructor(parentDiv, url, altText, doAlignCenter = true) {
		super(parentDiv, null, 'gui-image');
		altText = lang.process(altText, true);
		this.div.html(`&lt;img src='${url}' alt='${altText}'>`);
		if (doAlignCenter) {
			this.div.style('text-align', 'center');
		}
	}
}

/** Horizontal rule used to divide sections. */
class Divider extends Field {
	constructor(parentDiv) {
		super(parentDiv, null, 'gui-divider');
		this.div.html('&lt;hr>');
	}
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Button.html">Button</a></li><li><a href="ChangeSet.html">ChangeSet</a></li><li><a href="ColourBoxes.html">ColourBoxes</a></li><li><a href="ColourTextArea.html">ColourTextArea</a></li><li><a href="Controller.html">Controller</a></li><li><a href="Dialog.html">Dialog</a></li><li><a href="DieIcon.html">DieIcon</a></li><li><a href="Divider.html">Divider</a></li><li><a href="DualRangeInput.html">DualRangeInput</a></li><li><a href="Field.html">Field</a></li><li><a href="FileLoader.html">FileLoader</a></li><li><a href="GUIForP5.html">GUIForP5</a></li><li><a href="GUIImage.html">GUIImage</a></li><li><a href="Generator.html">Generator</a></li><li><a href="ImageLoader.html">ImageLoader</a></li><li><a href="JSONFileLoader.html">JSONFileLoader</a></li><li><a href="Label.html">Label</a></li><li><a href="Lang.html">Lang</a></li><li><a href="MultiColourBoxes.html">MultiColourBoxes</a></li><li><a href="Randomizer.html">Randomizer</a></li><li><a href="RangeSlider.html">RangeSlider</a></li><li><a href="RendererSVG.html">RendererSVG</a></li><li><a href="ResolutionSelect.html">ResolutionSelect</a></li><li><a href="ResolutionTextboxes.html">ResolutionTextboxes</a></li><li><a href="Select.html">Select</a></li><li><a href="Slider.html">Slider</a></li><li><a href="TextFileLoader.html">TextFileLoader</a></li><li><a href="Textarea.html">Textarea</a></li><li><a href="Textbox.html">Textbox</a></li><li><a href="Textfield.html">Textfield</a></li><li><a href="Title.html">Title</a></li><li><a href="Toggle.html">Toggle</a></li><li><a href="ValuedController.html">ValuedController</a></li><li><a href="XYSlider.html">XYSlider</a></li></ul><h3>Global</h3><ul><li><a href="global.html#availableLangKeys">availableLangKeys</a></li><li><a href="global.html#createGUI">createGUI</a></li><li><a href="global.html#dialog">dialog</a></li><li><a href="global.html#dictionary">dictionary</a></li><li><a href="global.html#getAPaperResolutionOptionAtDpi">getAPaperResolutionOptionAtDpi</a></li><li><a href="global.html#lang">lang</a></li><li><a href="global.html#language">language</a></li><li><a href="global.html#parent">parent</a></li><li><a href="global.html#resolutionOptions">resolutionOptions</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Thu Jul 17 2025 10:49:07 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
